# 恶意代码分析与防治技术

- 授课时间：2024FALL
- 授课教师：王志 邓琮弋

## 总体评价

经历过汇编的毒打，马上到来的就是汇编PLUSSSS——《恶意代码分析与防治技术》。这本书的封面十分搞笑，也成为了我期末周的微信头像。

今年，在之前学长提到过的13次实验报告之上再再再加码，据不完全统计，本学期我大概完成了**11-12次小实验报告**（也就是课本后面的Lab），**两次雨课堂讨论**（没说记不记分），以及**一个恶意代码识别机器学习大作业**（由于实在是写不完了，所以延期到了期末后）。

和周学长所说的一样，这门课的实验不是特别值得你去认真做，因为内容实在是太多了。**几乎每一个实验报告都要花去我一天左右的时间。** 在大三上这无疑是致命的（你知道的，OS和编译几乎把所有人的课余时间都占满了）。

平时的实验分数占到30分，考勤分数20分，只要平时正常签到了，正常答题了，20分应该是可以拿满的。但是实验所占的30分就不好说了。跟汇编一样，恶意代码也有一次实验答辩，是自己在群里进行接龙。跟汇编的区别是，恶意代码是个人展示，打分由老师或者助教给出，一般不会特别高。想要得高分需要做出创新点（大部分人都是直接水水过，所以无所谓）

另外，实验部分的得分“貌似”是和报告页数成正相关的。这一点我不太清楚，大家权衡一下自己的精力再去做出选择，毕竟大三上其他课已经够人忙的了。。。（就我个人而言，撰写30页左右的报告可以得到90-92分，而撰写50-60页的报告就可以几乎获得满分，大家可以查看我的仓库，里面存放了我的所有实验报告）

## 得分情况

给分稍微比之前的汇编要好上一些，但是给分也不算高。本人实验报告部分写的很多，最后实验应该还是扣去了3-5分（不是很清楚），卷面答的还行，最后也是拿到了90+的成绩。问了周围一些强者，大部分也都在90出头，不会有很高的分数。总之这门课的平时分部分一定要注意了！！！缺勤是真的会扣分的！还有雨课堂中的答题，不一定要对，但是一定要按时完成。

## 学习策略

首先，该门课程的PPT极为抽象（几乎一半的英文，内容的重点全部使用一些废话说明，所以光看PPT几乎抓不到什么重点）。你几乎看不懂老师PPT的逻辑，包括上课听讲时估计也是云里雾里。所以强烈推荐大家直接阅读该课程的中文版电子书，或者可以看我的网盘中提供的该课程的总结笔记，应该一共是两份笔记，一份是全部的内容，一份是根据期末画的重点总结出的笔记，有需要可以查看。

另外，学堂在线上有王老师之前录制的课程，可以当作预习视频来进行观看。但是缺点就是，内容较少，而且跟课本中的内容有一些出入。建议还是直接阅读中文版课本，把课程内容都阅读一遍，比对着PPT硬看有效多了。

对于期末考试的复习策略，可以参考王老师在最后一次课中画的重点。据我所知，21级的划重点是很全的，考试内容也几乎在重点之中，但是我们这一届，由于之前少了一次课，所以导致了最后一次课划重点时，老师只说了一句：”可以参考PPT上重难点的部分，那些都是重点“。然后就没有然后了。但是按照考试内容来看，考试的默写题的范围明显是要大于PPT中的重难点的范围的，所以不要轻信老师的重点，建议还是从头到尾把知识都看一遍，期末再针对老师画的重点去进行复习，这样是最好的。

**各题型的复习策略：**

- 选择题（单选+多选）：几乎都是原题！！！所以这部分分数一定不能丢了！！！具体需要看的（我都整理好放在云盘中了）
  - 雨课堂中出现的所有选择题，一定要看！！
  - 学堂在线中的题，也要刷一下，今年的考试很多的选择题都来自学堂在线
  - 之前学长提供的一份国外的选择题整理，比较有用
- 默写题：这部分是最杂的，但是大部分都是在PPT中的重难点，yara几乎必考，其他一些考点也没咋变，大家可以对比近几年的回忆版
- 分析题：这一部分是PPT中出现过的代码，建议大家针对PPT中出现过代码的部分内容（**尤其是重难点部分的代码**，我记得一共只有6处）进行复习，会有大作用的。

## 平时作业

一共是下面这些实验，真的是太多了。。。中间有一次（识别汇编中的C代码结构）应该是我多写的，预判老师布置的作业失败了。

- 实验一：基本静态分析技术实战
- 实验二：虚拟机技术
- 实验三：基本动态分析
- 实验四：IDAPython
- 实验五：识别汇编中的C代码结构
- 实验六：分析恶意Windows程序
- 实验七：R77隐藏效果的验证实验
- 实验八：恶意代码行为
- 实验九：R77技术分析
- 实验十：隐蔽的恶意代码启动
- 实验十一：数据加密
- 实验十二：恶意代码的网络特征
- 大作业：恶意代码检测模型

## 考试内容

**仅回忆本年度（2024FALL）的考题**，之前两个年度的回忆版在ICU都已经有学长提供了，在我的仓库中也有对应的文件。由于王老师的考试题几乎不怎么发生很大的变化，所以大家自行体会。由于ICU不好放图，所以下面的回忆可能有些不清楚，大家可以查看我仓库中的PDF文件。

### 单选题(2分一个,共20分)

- 通过查看反汇编，是什么分析技术？——静态高级分析
- 恶意代码基于windows GINA的凭证窃取过程哪一个是正确的？——winlogon，fsgina，msgina
- 如何截获进程内部的消息？——hook那一块的，答案我不是很确定
- 哪个攻击用到了可警告的等待状态？——APC注入
- 一个简单的yara，涉及到[]的使用，没其他啥知识点
- 考了一个base64自定义解密，不难，要了解base64的加密机制
- 下面哪个不是混淆技术的目的？——选隐藏动态行为那个，也是基本原题了
- 考察驱动程序。选错误的那个，选 只能有一个过滤驱动程序，这个是错的
- 还有两个题想不起来了

### 多选题(2分一个,共10分)

注意，多选题只要选错就是0分，老师在考试前说也可以选一个，但是考试中似乎没有出现，但是出现了全选的题。

- 考了一个yara分析，涉及到nocase，#，@等
- IDA Python可以读取以下哪些信息？——当前内存地址，节信息，指令助记符，指令操作数
- 恶意驱动程序的攻击目标？原题！——ntoskrnl.exe，hal.dll
- 虚拟机的缺点，很明显的一个题，有一个选项说的是优点，算是送分了
- svchost.exe不能用在哪些地方？——这题答案不是很确定
  - A.OWN
  - B.KERNEL
  - C.SHARE
  - D.COM

### 简答题(5分一个,共8个)

- 写出常见的5种恶意代码类型，并简单解释其攻击方式
- 涉及到SEH异常处理，给了一段代码，问：int3中断后，程序会如何执行？
- 为什么要使用简单数据加密？简单数据加密的优点？写出三种简单数据加密的方式
- 写出HOOK注入，APC注入，进程注入的简要说明
- 写一个yara。涉及到PE文件，地址出现位置，所有的含a的字符串的地址都小于1000，第二次出现的字符串的地址等于3000，文件大小在20KB到2MB之间
- 默写DNS沉洞，IDS，IPS，网页代理和邮件代理的原理
- 五种持久化机制，写出名字和对应的原理
- 解释设备栈，驱动栈，以及设备和驱动的关系。防火墙是什么类型的驱动程序？

### 分析题(15分一个,共2个)

代码都是PPT中的标红重难点部分，而且一共就没多少代码，建议都看一遍。

**1.进程替换相关的代码，和PPT基本一样，提供API函数的作用，不用硬背**

- 说出这个代码使用的恶意行为方式？
- 恶意代码攻击了主机中的哪个进程？
- 简单说明一下攻击的流程（解释代码！）
- 被感染的程序涉及到什么状态？（不太懂要写啥）
- 为什么要攻击这个进程？

**2.简单的SSDT和IDT，和21级考的几乎一模一样**

- 解释一下SSDT和IDT是什么
- 恶意代码如何完成SSDT和IDT的注入？
- 分析代码

分析对应的挂钩过程，分析哪个rootkit的模块挂钩了哪个SSDT的函数，看PPT就行

## 总结

大三上是一个最难熬的学期。相比于OS编译计网三门大课，该课程实际上考试是较为套路化的，和汇编一样。希望大家可以撑过去。一起加油！
